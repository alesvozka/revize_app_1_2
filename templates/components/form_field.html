{% macro render_field(field_name, field_label, current_value='', entity_type='', dropdown_config={}, dropdown_sources={}, input_type='text', required=false, placeholder='', help_text='', extra_attrs='') %}
    {% set config = dropdown_config.get(field_name, {}) %}
    {% set dropdown_enabled = config.get('enabled', false) %}
    {% set dropdown_category = config.get('category', '') %}
    
    {% if dropdown_enabled and dropdown_category %}
        <!-- Compact Dropdown Widget -->
        <div class="dropdown-widget-container" data-field="{{ field_name }}" data-category="{{ dropdown_category }}">
            <label for="{{ field_name }}" class="block text-sm font-medium text-gray-700 mb-2">
                {{ field_label }}{% if required %} *{% endif %}
            </label>
            
            <!-- Combo Box: Input + Dropdown -->
            <div class="relative">
                <!-- Input field (editable, for direct typing) -->
                <input type="{{ input_type }}" 
                       id="{{ field_name }}" 
                       name="{{ field_name }}"
                       value="{{ current_value }}"
                       placeholder="{{ placeholder or 'Vyberte nebo zadejte hodnotu...' }}"
                       autocomplete="off"
                       {% if required %}required{% endif %}
                       class="w-full px-3 py-2 pr-10 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                       {{ extra_attrs|safe }}>
                
                <!-- Dropdown toggle button -->
                <button type="button" 
                        onclick="toggleFormDropdown('{{ field_name }}')"
                        class="absolute right-0 top-0 h-full px-3 text-gray-500 hover:text-gray-700 border-l border-gray-300 bg-gray-50 hover:bg-gray-100 transition-colors rounded-r">
                    <svg class="w-4 h-4 transition-transform dropdown-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                </button>
                
                <!-- Dropdown options -->
                <div class="dropdown-options absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded shadow-lg max-h-60 overflow-y-auto hidden">
                    {% if dropdown_sources.get(dropdown_category) %}
                        {% for source in dropdown_sources.get(dropdown_category, []) %}
                        <div class="dropdown-option px-3 py-2 hover:bg-blue-50 cursor-pointer text-gray-900 {% if current_value == source.value %}bg-blue-50 font-medium{% endif %}"
                             onclick="selectFormDropdownValue('{{ field_name }}', '{{ source.value }}')">
                            {{ source.value }}
                        </div>
                        {% endfor %}
                        
                        <!-- Separator -->
                        <div class="border-t border-gray-200 my-1"></div>
                    {% endif %}
                    
                    <!-- Add new value option -->
                    <div class="dropdown-option px-3 py-2 hover:bg-green-50 cursor-pointer text-green-700 font-medium flex items-center gap-2"
                         onclick="openFormAddValueModal('{{ field_name }}', '{{ dropdown_category }}')">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                        </svg>
                        P≈ôidat novou hodnotu...
                    </div>
                </div>
            </div>

            {% if help_text %}
            <p class="mt-1 text-xs text-gray-500">{{ help_text }}</p>
            {% else %}
            <p class="mt-1 text-xs text-gray-500">
                üí° <strong>Tip:</strong> Pi≈°te p≈ô√≠mo pro jednor√°zovou hodnotu, nebo kliknƒõte na ≈°ipku pro v√Ωbƒõr z datab√°ze
            </p>
            {% endif %}
        </div>
    {% else %}
        <!-- Standard Input Field -->
        <div>
            <label for="{{ field_name }}" class="block text-sm font-medium text-gray-700 mb-1">
                {{ field_label }}{% if required %} *{% endif %}
            </label>
            <input type="{{ input_type }}" 
                   id="{{ field_name }}"
                   name="{{ field_name }}" 
                   value="{{ current_value }}"
                   {% if required %}required{% endif %}
                   placeholder="{{ placeholder }}"
                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"
                   {{ extra_attrs|safe }}>
            {% if help_text %}
            <p class="mt-1 text-xs text-gray-500">{{ help_text }}</p>
            {% endif %}
        </div>
    {% endif %}
{% endmacro %}
