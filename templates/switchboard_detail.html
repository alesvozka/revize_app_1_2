{% extends "base.html" %}
{% block title %}Rozvadƒõƒç ‚Äì detail{% endblock %}
{% block content %}
<a href="/revisions/{{ revision.revision_id }}" class="btn btn-link mb-2">&larr; Zpƒõt na revizi</a>

<div class="d-flex justify-content-between align-items-center mb-3">
  <div>
    <h1 class="h4 mb-0">{{ switchboard.switchboard_name }}</h1>
    <div class="text-muted">
      {% if switchboard.switchboard_location %}
        <span class="me-2">M√≠sto: {{ switchboard.switchboard_location }}</span>
      {% endif %}
      {% if switchboard.switchboard_type %}
        <span class="me-2">Typ: {{ switchboard.switchboard_type }}</span>
      {% endif %}
      {% if switchboard.switchboard_serial_number %}
        <span>V√Ωrobn√≠ ƒç√≠slo: {{ switchboard.switchboard_serial_number }}</span>
      {% endif %}
    </div>
  </div>
  <form action="/switchboards/{{ switchboard.switchboard_id }}/delete" method="post" onsubmit="return confirm('Opravdu smazat rozvadƒõƒç?');">
    <button type="submit" class="btn btn-outline-danger btn-sm">Smazat</button>
  </form>
</div>

<div class="card mb-4">
  <div class="card-header">
    √ödaje o rozvadƒõƒçi
  </div>
  <div class="card-body">
    <form action="/switchboards/{{ switchboard.switchboard_id }}/edit" method="post" class="row g-2">
      <div class="col-md-4">
        <label class="form-label">N√°zev</label>
        <input type="text" name="switchboard_name" class="form-control" value="{{ switchboard.switchboard_name }}">
      </div>
      <div class="col-md-4">
        <label class="form-label">Um√≠stƒõn√≠</label>
        <input type="text" name="switchboard_location" class="form-control" value="{{ switchboard.switchboard_location or '' }}">
      </div>
      <div class="col-md-4">
        <label class="form-label">Pozn√°mka</label>
        <input type="text" name="switchboard_note" class="form-control" value="{{ switchboard.switchboard_note or '' }}">
      </div>
      <div class="col-12 mt-2">
        <button type="submit" class="btn btn-primary btn-sm">Ulo≈æit √∫daje rozvadƒõƒçe</button>
      </div>
    </form>
  </div>
</div>

<div class="card mb-4">
  <div class="card-header">
    Mƒõ≈ôen√≠ rozvadƒõƒçe
  </div>
  <div class="card-body">
    <form action="/switchboards/{{ switchboard.switchboard_id }}/measurements/save" method="post" class="row g-2">
      <div class="col-md-4">
        <label class="form-label">Riz izolace [MŒ©]</label>
        <input type="number" step="0.01" name="measurements_switchboard_insulation_resistance"
               class="form-control"
               value="{{ measurement.measurements_switchboard_insulation_resistance if measurement else '' }}">
      </div>
      <div class="col-md-4">
        <label class="form-label">Zs min [Œ©]</label>
        <input type="number" step="0.001" name="measurements_switchboard_loop_impedance_min"
               class="form-control"
               value="{{ measurement.measurements_switchboard_loop_impedance_min if measurement else '' }}">
      </div>
      <div class="col-md-4">
        <label class="form-label">Zs max [Œ©]</label>
        <input type="number" step="0.001" name="measurements_switchboard_loop_impedance_max"
               class="form-control"
               value="{{ measurement.measurements_switchboard_loop_impedance_max if measurement else '' }}">
      </div>
      <div class="col-md-4">
        <label class="form-label">tŒî [ms]</label>
        <input type="number" step="0.1" name="measurements_switchboard_rcd_trip_time_ms"
               class="form-control"
               value="{{ measurement.measurements_switchboard_rcd_trip_time_ms if measurement else '' }}">
      </div>
      <div class="col-md-4">
        <label class="form-label">IŒî [mA]</label>
        <input type="number" step="0.1" name="measurements_switchboard_rcd_test_current_ma"
               class="form-control"
               value="{{ measurement.measurements_switchboard_rcd_test_current_ma if measurement else '' }}">
      </div>
      <div class="col-md-4">
        <label class="form-label">Rz [Œ©]</label>
        <input type="number" step="0.1" name="measurements_switchboard_earth_resistance"
               class="form-control"
               value="{{ measurement.measurements_switchboard_earth_resistance if measurement else '' }}">
      </div>
      <div class="col-12 mt-2">
        <button type="submit" class="btn btn-primary btn-sm">Ulo≈æit mƒõ≈ôen√≠ rozvadƒõƒçe</button>
      </div>
    </form>
  </div>
</div>

<div class="card mb-4">
  <div class="card-header d-flex justify-content-between align-items-center">
    <span>P≈ô√≠stroje v rozvadƒõƒçi</span>
    <span class="small text-muted">Jistiƒçe, chr√°niƒçe, kombinovan√© p≈ô√≠stroje‚Ä¶</span>
  </div>
  <div class="card-body">
    <form id="device-form" action="/switchboards/{{ switchboard.switchboard_id }}/devices/create" method="post" class="border rounded p-3 mb-3 bg-light">
      <input type="hidden" name="device_id" id="device-id-field">
      <input type="hidden" name="parent_device_id" id="parent-device-id-field">

      <div class="row g-2">
        <div class="col-md-2">
          <label class="form-label">Pozice</label>
          <input type="text" name="switchboard_device_position" class="form-control form-control-sm" placeholder="nap≈ô. 1L">
        </div>
        <div class="col-md-2">
          <label class="form-label">Typ</label>
          <input type="text" name="switchboard_device_type" class="form-control form-control-sm" placeholder="MCB/RCD/RCBO">
        </div>
        <div class="col-md-3">
          <label class="form-label">V√Ωrobce</label>
          <input type="text" name="switchboard_device_manufacturer" class="form-control form-control-sm">
        </div>
        <div class="col-md-3">
          <label class="form-label">Model</label>
          <input type="text" name="switchboard_device_model" class="form-control form-control-sm">
        </div>
        <div class="col-md-2">
          <label class="form-label">Charakteristika</label>
          <input type="text" name="switchboard_device_trip_characteristic" class="form-control form-control-sm" placeholder="B/C/D">
        </div>
      </div>
      <div class="row g-2 mt-1">
        <div class="col-md-2">
          <label class="form-label">In [A]</label>
          <input type="number" step="1" name="switchboard_device_rated_current" class="form-control form-control-sm">
        </div>
        <div class="col-md-2">
          <label class="form-label">IŒîn [mA]</label>
          <input type="number" step="1" name="switchboard_device_residual_current_ma" class="form-control form-control-sm">
        </div>
        <div class="col-md-2">
          <label class="form-label">P√≥ly</label>
          <input type="number" step="1" name="switchboard_device_poles" class="form-control form-control-sm">
        </div>
        <div class="col-md-2">
          <label class="form-label">Moduly</label>
          <input type="number" step="0.5" name="switchboard_device_module_width" class="form-control form-control-sm">
        </div>
        <div class="col-md-4 d-flex align-items-end">
          <button type="submit" class="btn btn-primary btn-sm w-100">P≈ôidat p≈ô√≠stroj</button>
        </div>
      </div>
    </form>

    {% if devices %}
      <div class="table-responsive">
        
      <div class="mb-3">
        <div class="d-flex justify-content-between align-items-center">
          <h6 class="mb-1">Strom p≈ô√≠stroj≈Ø v rozvadƒõƒçi</h6>
          <small class="text-muted ms-2">Kliknut√≠m na + / ‚úèÔ∏è / üóë pracuje≈° s vybran√Ωm p≈ô√≠strojem.</small>
        </div>
        <div id="devices-tree-container" class="mt-2" style="max-height: 320px; overflow:auto; border: 1px solid #ddd; border-radius: .25rem; padding: .5rem;">
          <!-- Strom p≈ô√≠stroj≈Ø se vykresl√≠ pomoc√≠ JavaScriptu -->
        </div>
      </div>

<table class="table table-sm align-middle table-bordered bg-white">
          <thead class="table-light">
            <tr>
              <th>Pozice</th>
              <th>Typ</th>
              <th>Popis</th>
              <th>In / IŒîn / p√≥l≈Ø</th>
              <th>Obvody</th>
              <th style="width: 6rem;">Akce</th>
            </tr>
          </thead>
          <tbody>
            {% for dev in devices %}
              <tr>
                <td>{{ dev.switchboard_device_position }}</td>
                <td>
                  {{ dev.switchboard_device_type }}
                  {% if dev.switchboard_device_manufacturer or dev.switchboard_device_model %}
                    <div class="small text-muted">
                      {{ dev.switchboard_device_manufacturer }} {{ dev.switchboard_device_model }}
                    </div>
                  {% endif %}
                </td>
                <td>
                  {% if dev.switchboard_device_trip_characteristic %}
                    Char: {{ dev.switchboard_device_trip_characteristic }}
                  {% endif %}
                </td>
                <td>
                  <div class="small">
                    In: {{ dev.switchboard_device_rated_current or "-" }} A<br>
                    IŒîn: {{ dev.switchboard_device_residual_current_ma or "-" }} mA<br>
                    P√≥ly: {{ dev.switchboard_device_poles or "-" }} / Moduly: {{ dev.switchboard_device_module_width or "-" }}
                  </div>
                </td>
                <td>
                  {% if dev.circuits %}
                    {% for c in dev.circuits %}
                      <div class="border rounded p-2 mb-2">
                        <div class="d-flex justify-content_between">
                          <div>
                            <strong>{{ c.circuit_number or "Obvod" }}</strong>
                            {% if c.circuit_room %}
                              <span class="small text-muted">({{ c.circuit_room }})</span>
                            {% endif %}
                            {% if c.circuit_description %}
                              <div class="small">{{ c.circuit_description }}</div>
                            {% endif %}
                            {% if c.circuit_cable %}
                              <div class="small text-muted">
                                Kabel: {{ c.circuit_cable }} ({{ c.circuit_cable_installation_method or "" }})
                              </div>
                            {% endif %}
                          </div>
                          <form action="/circuits/{{ c.circuit_id }}/delete" method="post" onsubmit="return confirm('Smazat obvod?');">
                            <button type="submit" class="btn btn-outline-danger btn-sm">√ó</button>
                          </form>
                        </div>

                        <form action="/circuits/{{ c.circuit_id }}/measurements/save" method="post" class="mt-2">
                          <div class="row g-1">
                            <div class="col-4">
                              <input type="number" step="0.01" name="measurements_circuit_insulation_resistance"
                                     class="form-control form-control-sm"
                                     placeholder="Riz [MŒ©]"
                                     value="{{ c.measurements.measurements_circuit_insulation_resistance if c.measurements else '' }}">
                            </div>
                            <div class="col-4">
                              <input type="number" step="0.001" name="measurements_circuit_loop_impedance_min"
                                     class="form-control form-control-sm"
                                     placeholder="Zs min [Œ©]"
                                     value="{{ c.measurements.measurements_circuit_loop_impedance_min if c.measurements else '' }}">
                            </div>
                            <div class="col-4">
                              <input type="number" step="0.001" name="measurements_circuit_loop_impedance_max"
                                     class="form-control form-control-sm"
                                     placeholder="Zs max [Œ©]"
                                     value="{{ c.measurements.measurements_circuit_loop_impedance_max if c.measurements else '' }}">
                            </div>
                          </div>
                          <div class="row g-1 mt-1">
                            <div class="col-4">
                              <input type="number" step="0.1" name="measurements_circuit_rcd_trip_time_ms"
                                     class="form-control form-control-sm"
                                     placeholder="tŒî [ms]"
                                     value="{{ c.measurements.measurements_circuit_rcd_trip_time_ms if c.measurements else '' }}">
                            </div>
                            <div class="col-4">
                              <input type="number" step="0.1" name="measurements_circuit_rcd_test_current_ma"
                                     class="form-control form-control-sm"
                                     placeholder="IŒî [mA]"
                                     value="{{ c.measurements.measurements_circuit_rcd_test_current_ma if c.measurements else '' }}">
                            </div>
                            <div class="col-4">
                              <input type="number" step="0.1" name="measurements_circuit_earth_resistance"
                                     class="form-control form-control-sm"
                                     placeholder="Rz [Œ©]"
                                     value="{{ c.measurements.measurements_circuit_earth_resistance if c.measurements else '' }}">
                            </div>
                          </div>
                          <div class="row g-1 mt-1">
                            <div class="col-4">
                              <input type="number" step="0.1" name="measurements_circuit_continuity"
                                     class="form-control form-control-sm"
                                     placeholder="R smyƒçky [Œ©]"
                                     value="{{ c.measurements.measurements_circuit_continuity if c.measurements else '' }}">
                            </div>
                            <div class="col-8">
                              <input type="text" name="measurements_circuit_order_of_phases"
                                     class="form-control form-control-sm"
                                     placeholder="Po≈ôad√≠ f√°z√≠"
                                     value="{{ c.measurements.measurements_circuit_order_of_phases if c.measurements else '' }}">
                            </div>
                          </div>
                          <button type="submit" class="btn btn-outline-primary btn-sm mt-1">Ulo≈æit mƒõ≈ôen√≠ obvodu</button>
                        </form>

                        <hr class="my-2">

                        <div class="small fw-semibold mb-1">Koncov√° za≈ô√≠zen√≠</div>
                        {% if c.terminal_devices %}
                          <ul class="small mb-2">
                            {% for td in c.terminal_devices %}
                              <li>
                                {{ td.terminal_device_type or "Za≈ô√≠zen√≠" }}
                                {% if td.terminal_device_marking %}
                                  ‚Äì {{ td.terminal_device_marking }}
                                {% endif %}
                                {% if td.terminal_device_power %}
                                  ({{ td.terminal_device_power }} W)
                                {% endif %}
                                <form action="/terminal-devices/{{ td.terminal_device_id }}/delete"
                                      method="post" class="d-inline"
                                      onsubmit="return confirm('Smazat za≈ô√≠zen√≠?');">
                                  <button type="submit" class="btn btn-link btn-sm text-danger p-0 ms-1">smazat</button>
                                </form>
                              </li>
                            {% endfor %}
                          </ul>
                        {% else %}
                          <div class="small text-muted">≈Ω√°dn√° koncov√° za≈ô√≠zen√≠.</div>
                        {% endif %}

                        <form action="/circuits/{{ c.circuit_id }}/terminal-devices/create" method="post" class="mt-1">
                          <div class="row g-1">
                            <div class="col-4">
                              <input type="text" name="terminal_device_type" class="form-control form-control-sm" placeholder="Typ">
                            </div>
                            <div class="col-4">
                              <input type="text" name="terminal_device_marking" class="form-control form-control-sm" placeholder="Oznaƒçen√≠">
                            </div>
                            <div class="col-4">
                              <input type="number" step="1" name="terminal_device_power" class="form-control form-control-sm" placeholder="V√Ωkon [W]">
                            </div>
                          </div>
                          <div class="row g-1 mt-1">
                            <div class="col-4">
                              <input type="text" name="terminal_device_manufacturer" class="form-control form-control-sm" placeholder="V√Ωrobce">
                            </div>
                            <div class="col-4">
                              <input type="text" name="terminal_device_model" class="form-control form-control-sm" placeholder="Model">
                            </div>
                            <div class="col-4">
                              <input type="text" name="terminal_device_ip_rating" class="form-control form-control-sm" placeholder="IP">
                            </div>
                          </div>
                          <div class="row g-1 mt-1">
                            <div class="col-4">
                              <input type="text" name="terminal_device_protection_class" class="form-control form-control-sm" placeholder="T≈ô√≠da ochr.">
                            </div>
                            <div class="col-4">
                              <input type="text" name="terminal_device_supply_type" class="form-control form-control-sm" placeholder="Nap√°jen√≠">
                            </div>
                            <div class="col-4">
                              <input type="text" name="terminal_device_installation_method" class="form-control form-control-sm" placeholder="Instalace">
                            </div>
                          </div>
                          <button type="submit" class="btn btn-outline-primary btn-sm mt-1">+ Za≈ô√≠zen√≠</button>
                        </form>

                      </div>
                    {% endfor %}
                  {% else %}
                    <div class="small text-muted mb-1">≈Ω√°dn√© obvody.</div>
                  {% endif %}

                  <form action="/devices/{{ dev.device_id }}/circuits/create" method="post" class="mt-1">
                    <div class="row g-1">
                      <div class="col-3">
                        <input type="text" name="circuit_number" class="form-control form-control-sm" placeholder="ƒå. obvodu">
                      </div>
                      <div class="col-3">
                        <input type="text" name="circuit_room" class="form-control form-control-sm" placeholder="M√≠stnost">
                      </div>
                      <div class="col-3">
                        <input type="text" name="circuit_cable" class="form-control form-control-sm" placeholder="Kabel (nap≈ô. CYKY)">
                      </div>
                      <div class="col-3">
                        <input type="number" step="1" name="circuit_number_of_outlets" class="form-control form-control-sm" placeholder="Z√°suvky/ks">
                      </div>
                    </div>
                    <div class="row g-1 mt-1">
                      <div class="col-9">
                        <input type="text" name="circuit_description" class="form-control form-control-sm" placeholder="Popis obvodu">
                      </div>
                      <div class="col-3">
                        <button type="submit" class="btn btn-outline-primary btn-sm w-100">+ Obvod</button>
                      </div>
                    </div>
                  </form>
                </td>
                <td>
                  <form action="/devices/{{ dev.device_id }}/delete" method="post" onsubmit="return confirm('Smazat p≈ô√≠stroj a v≈°echny obvody?');">
                    <button type="submit" class="btn btn-sm btn-danger">Smazat</button>
                  </form>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <div class="text-muted">Zat√≠m ≈æ√°dn√© p≈ô√≠stroje.</div>
    {% endif %}
  </div>
</div>


<script>
  (function() {
    if (typeof window === 'undefined') return;

    const SWITCHBOARD_ID = {{ switchboard.switchboard_id }};
    const devicesData = [
      {% for dev in devices %}
      {
        device_id: {{ dev.device_id }},
        parent_device_id: {{ dev.parent_device_id or 'null' }},
        position: {{ dev.switchboard_device_position|tojson }},
        type: {{ dev.switchboard_device_type|tojson }},
        manufacturer: {{ dev.switchboard_device_manufacturer|tojson }},
        model: {{ dev.switchboard_device_model|tojson }},
        trip: {{ dev.switchboard_device_trip_characteristic|tojson }},
        rated_current: {{ dev.switchboard_device_rated_current or 'null' }},
        residual_current_ma: {{ dev.switchboard_device_residual_current_ma or 'null' }},
        poles: {{ dev.switchboard_device_poles or 'null' }},
        module_width: {{ dev.switchboard_device_module_width or 'null' }},
      }{% if not loop.last %},{% endif %}
      {% endfor %}
    ];

    function buildTree(devices) {
      const byId = {};
      devices.forEach(d => {
        byId[d.device_id] = Object.assign({}, d, { children: [] });
      });
      const roots = [];
      devices.forEach(d => {
        const item = byId[d.device_id];
        if (d.parent_device_id && byId[d.parent_device_id]) {
          byId[d.parent_device_id].children.push(item);
        } else {
          roots.push(item);
        }
      });
      const sortChildren = (node) => {
        if (!node.children) return;
        node.children.sort((a, b) => {
          const pa = a.position || '';
          const pb = b.position || '';
          return pa.localeCompare(pb, 'cs', { numeric: true });
        });
        node.children.forEach(sortChildren);
      };
      roots.forEach(sortChildren);
      roots.sort((a, b) => {
        const pa = a.position || '';
        const pb = b.position || '';
        return pa.localeCompare(pb, 'cs', { numeric: true });
      });
      return roots;
    }

    const treeData = buildTree(devicesData);

    function buildNodeLabel(node) {
      const pos = node.position || '';
      const t = node.type || '';
      const In = node.rated_current;
      const Idn = node.residual_current_ma;
      const trip = node.trip || '';
      if (t === 'RCD') {
        return `${pos} ‚Äì RCD ${In || ''}A / ${Idn || ''}mA`.trim();
      } else if (t === 'MCB') {
        return `${pos} ‚Äì MCB ${In || ''}A ${trip}`.trim();
      } else if (t) {
        return `${pos} ‚Äì ${t}`.trim();
      } else {
        return pos || `ID ${node.device_id}`;
      }
    }

    function renderTree() {
      const container = document.getElementById('devices-tree-container');
      if (!container) return;
      container.innerHTML = '';
      if (!treeData || treeData.length === 0) {
        container.innerHTML = '<div class="text-muted small">Zat√≠m ≈æ√°dn√© p≈ô√≠stroje.</div>';
        return;
      }
      const ul = document.createElement('ul');
      ul.className = 'list-unstyled mb-0';
      renderNodes(treeData, ul);
      container.appendChild(ul);
    }

    function renderNodes(nodes, parentEl) {
      nodes.forEach(node => {
        const li = document.createElement('li');
        li.className = 'mb-1';

        const row = document.createElement('div');
        row.className = 'd-flex align-items-center gap-1';

        const labelSpan = document.createElement('span');
        labelSpan.textContent = buildNodeLabel(node);
        labelSpan.className = 'flex-grow-1';
        row.appendChild(labelSpan);

        const addBtn = document.createElement('button');
        addBtn.type = 'button';
        addBtn.className = 'btn btn-sm btn-outline-success';
        addBtn.textContent = '+';
        addBtn.title = 'P≈ôidat pod≈ô√≠zen√Ω p≈ô√≠stroj';
        addBtn.onclick = (e) => {
          e.preventDefault();
          startAddChild(node);
        };
        row.appendChild(addBtn);

        const editBtn = document.createElement('button');
        editBtn.type = 'button';
        editBtn.className = 'btn btn-sm btn-outline-primary';
        editBtn.textContent = '‚úèÔ∏è';
        editBtn.title = 'Upravit p≈ô√≠stroj';
        editBtn.onclick = (e) => {
          e.preventDefault();
          startEditDevice(node);
        };
        row.appendChild(editBtn);

        const delBtn = document.createElement('button');
        delBtn.type = 'button';
        delBtn.className = 'btn btn-sm btn-outline-danger';
        delBtn.textContent = 'üóë';
        delBtn.title = 'Smazat p≈ô√≠stroj';
        delBtn.onclick = (e) => {
          e.preventDefault();
          deleteDevice(node);
        };
        row.appendChild(delBtn);

        li.appendChild(row);

        if (node.children && node.children.length > 0) {
          const childUl = document.createElement('ul');
          childUl.className = 'list-unstyled ms-4 mt-1 mb-0';
          renderNodes(node.children, childUl);
          li.appendChild(childUl);
        }

        parentEl.appendChild(li);
      });
    }

    function fillDeviceForm(node) {
      const form = document.getElementById('device-form');
      if (!form) return;
      const deviceIdField = document.getElementById('device-id-field');
      const parentIdField = document.getElementById('parent-device-id-field');

      if (deviceIdField) deviceIdField.value = node.device_id || '';
      if (parentIdField) parentIdField.value = node.parent_device_id || '';

      const setVal = (name, value) => {
        const input = form.querySelector(`[name="${name}"]`);
        if (input) input.value = (value !== null && value !== undefined) ? value : '';
      };

      setVal('switchboard_device_position', node.position);
      setVal('switchboard_device_type', node.type);
      setVal('switchboard_device_manufacturer', node.manufacturer);
      setVal('switchboard_device_model', node.model);
      setVal('switchboard_device_trip_characteristic', node.trip);
      setVal('switchboard_device_rated_current', node.rated_current);
      setVal('switchboard_device_residual_current_ma', node.residual_current_ma);
      setVal('switchboard_device_poles', node.poles);
      setVal('switchboard_device_module_width', node.module_width);

      form.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    function clearDeviceForm() {
      const form = document.getElementById('device-form');
      if (!form) return;
      form.reset();
      const deviceIdField = document.getElementById('device-id-field');
      const parentIdField = document.getElementById('parent-device-id-field');
      if (deviceIdField) deviceIdField.value = '';
      if (parentIdField) parentIdField.value = '';
    }

    function startAddChild(node) {
      clearDeviceForm();
      const parentIdField = document.getElementById('parent-device-id-field');
      if (parentIdField) parentIdField.value = node.device_id;
      const form = document.getElementById('device-form');
      if (form) {
        form.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
    }

    function startEditDevice(node) {
      fillDeviceForm(node);
    }

    function deleteDevice(node) {
      if (!confirm('Opravdu smazat tento p≈ô√≠stroj?')) return;
      const form = document.createElement('form');
      form.method = 'post';
      form.action = `/devices/${node.device_id}/delete`;
      document.body.appendChild(form);
      form.submit();
    }

    document.addEventListener('DOMContentLoaded', renderTree);
  })();
</script>


{% endblock %}
